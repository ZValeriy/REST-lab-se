# Методические указания к лабораторной работе
## Тема: Проектирование REST API с использованием OpenAPI, FastAPI и LLM-инструментов

## Введение
REST API (Representational State Transfer API) — это архитектурный стиль, позволяющий системам обмениваться данными по HTTP.
OpenAPI (ранее Swagger) — спецификация, позволяющая описывать REST API формально: методы, параметры, ответы, авторизацию.
Swagger UI — визуальный интерфейс, генерируемый на основе OpenAPI, где можно протестировать API.
Цель лабораторной работы — пройти полный цикл проектирования и реализации API:
- Проектирование OpenAPI-спецификации
- Создание и использование mock-сервера
- Генерация и реализация кода на FastAPI (python)
- Генерация и запуск контрактных тестов
- Изучение принципов версионирования API


Дополнительно студенты будут использовать LLM-инструменты (например, ChatGPT, DeepSeek или аналоги) как ассистента для генерации спецификаций, кода и тестов.

## Требования к исходным артефактам
В результате выполнения лабораторной работы студент должен предоставить:
openapi.yaml — спецификация API с 8 методами для ресурса orders


docker-compose.yaml — инфраструктура с mock-сервером и FastAPI-приложением


Dockerfile — сборка приложения на FastAPI


app.py — реализация API


test_contracts.py — контрактные тесты (pytest)


Документ: описание изменений в openapi_v2.yaml, включая типы изменений (backward-, forward-, breaking)



## Шаги выполнения лабораторной работы
### Шаг 0. Подготовка проекта
Скачайте репозиторий по [ссылке](https://github.com/ZValeriy/REST-lab-se)
### Шаг 1. Проектирование API в OpenAPI
#### Порядок действий:
1. Перейдите в директорию steps/step_1
1. Создайте файл openAPI.yaml
1. Спроектируйте методы для управления заказами в интернет-магазине и опишите их в openAPI.yaml:
    1. Создание заказа
    1. Получение списка заказов
    1. Получение заказа по его идентификатору
    1. Отмена заказа
    1. Просмотр каталога товаров
    1. Добавление товаров в заказ
    1. Изменение количества товара в заказе
    1. Удаление товара из заказа
#### Примечания
- Используете схемы
- Используйте валидацию
- Опишите все параметры
- Используйте Basic Auth
#### Пример
Пример описания методов можно посмотреть в [файле](./steps/step_1/openAPI_example.yaml)
#### Полезные материалы
Краткую информацию об openAPI и составляющих компонентах вы можете найти в [файле](./steps/step_1/openAPI_description.md)


### Шаг 2. Поднятие mock-сервера
Студент должен использовать prism или openapi-mock.
Шаблон docker-compose.yaml:
version: '3.8'
services:
  mock-server:
    image: stoplight/prism:4
    command: mock -h 0.0.0.0 /openapi.yaml
    volumes:
      - ./openapi.yaml:/openapi.yaml
    ports:
      - "8080:4010"
Пример проверки:
curl http://localhost:8080/orders

### Шаг 3. Проработка мок-ответов
С помощью LLM студент генерирует ответы для следующих случаев:
HTTP 200 — успешный ответ


HTTP 400 — ошибка валидации (например, отрицательная сумма)


HTTP 404 — не найден


HTTP 409 — дубликат


Пример промпта для LLM:
“Сгенерируй примеры мок-ответов (JSON) для методов API /orders. Включи ответы на 200, 400, 404, 409.”

### Шаг 4. Генерация кода приложения (FastAPI)
Используя openapi.yaml, студент с помощью LLM генерирует:
app.py с маршрутами и pydantic-моделями


Хранение данных — in-memory (например, словарь)


Валидация, коды ответов, сообщения об ошибках



### Шаг 5. Запуск FastAPI и ручное тестирование
docker-compose.yaml:
version: '3.8'
services:
  app:
    build: .
    ports:
      - "8000:8000"
Dockerfile:
FROM python:3.11
WORKDIR /app
COPY . .
RUN pip install fastapi uvicorn pydantic
CMD ["uvicorn", "app:app", "--host", "0.0.0.0", "--port", "8000"]
Запуск:
docker-compose up --build
Перейти в Swagger UI:
http://localhost:8000/docs

### Шаг 6. Генерация контракт-тестов
Используя LLM:
Пример промпта:
“Создай pytest-тесты, которые проверяют, что поведение API соответствует спецификации openapi.yaml.”
Файл test_contracts.py должен включать:
Проверку кода ответа


Проверку структуры тела ответа


Проверку обязательных полей



### Шаг 7. Версионирование API
Обновить openapi.yaml → openapi_v2.yaml с учетом:
Типы изменений:
Backward-compatible: добавление необязательного поля


Forward-compatible: добавление новых значений в enum


Breaking: переименование поля amount → total_amount


Переиспользовать контрактные тесты и зафиксировать, какие из них ломаются.
Задача:
Обновить мок и код


Зафиксировать изменения и типы в отдельном документе



### Шаг 8. Контрольные вопросы
Что такое контракт между клиентом и сервером?


Чем отличаются backward- и forward-compatible изменения?


Что означает код ответа 400? А 404 и 409?


Зачем нужен mock-сервер до написания кода?


В чём польза контрактного тестирования?


Как использовать LLM для ускорения разработки?


Какие риски связаны с breaking changes?


Что такое спецификация OpenAPI и как она помогает разработчику?



## Краткое описание OpenAPI
Основные разделы:
Раздел
Назначение
openapi
Версия спецификации (например, "3.0.3")
info
Метаданные API: название, описание, версия, лицензия
servers
Базовые URL, на которых доступно API
paths
Основной раздел: описание всех маршрутов и методов (GET, POST и т.д.)
tags
Группировка операций по логике (например, Users, Orders)
externalDocs
Ссылки на внешнюю документацию
security
Глобальные требования авторизации (можно переопределить на уровне методов)  

Описание шаблона




